<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <script type="text/javascript" src="/static/paratii.min.js"></script>
  </head>
  <body>
    <form id="form">
      <input type="file" id="fileinput" multiple="multiple" />
      <input type="submit" value="upload">
    </form>
    <div id="player"></div>
    <script>
    var fileToUpload
    var resumableFile
    var player

    // Inizialize ParatiiJS with a public publicaddress and a proper privateKey
    // NB Use a proper wallet to manage publicaddress and privatekey
    var paratii = new paratiijs.Paratii({
      account: {
        address: '0x9e2d04eef5b16CFfB4328Ddd027B55736407B275',
        privateKey: '399b141d0cc2b863b2f514ffe53edc6afc9416d5899da4d9bd2350074c38f1c6'
      }
    })

    //bind change event to input file
    document.getElementById('fileinput').addEventListener('change', function(){
        fileToUpload = this.files[0];
    }, false);


    document.getElementById('form').addEventListener("submit", function(evt) {
        //prevent default form submit
        evt.preventDefault();
        if(fileToUpload){
          //if a file is defined upload it and trancode
          resumableFile = paratii.ipfs.uploader.addAndTranscode(fileToUpload)

          //listening for trasconding:done event
          resumableFile.on('transcoding:done', function(file, message){
            player = new Clappr.Player(
              {
                source: "https://gateway.paratii.video/ipfs/"+message.master.hash+"/master.m3u8",
                parentId: "#player",
                mimeType: 'application/x-mpegURL'
              }
            );
          });
        } else {
          alert("please select a file")
        }
    }, true);
    </script>
  </body>
</html>
